name: Manual Cancel Workflow Runs

on:
  workflow_dispatch:
    inputs:
      run_ids:
        description: 'Comma-separated list of run IDs to cancel'
        required: true
        type: string

permissions:
  actions: write
  contents: read

jobs:
  cancel-runs:
    runs-on: ubuntu-latest
    steps:
      - name: Cancel specified workflow runs
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const runIds = '${{ inputs.run_ids }}'.split(',').map(id => id.trim());
            
            console.log(`Canceling ${runIds.length} workflow runs`);
            
            for (const runId of runIds) {
              console.log(`Canceling workflow run ${runId}...`);
              try {
                await github.request('POST /repos/{owner}/{repo}/actions/runs/{run_id}/force-cancel', {
                  owner,
                  repo,
                  run_id: parseInt(runId)
                });
                console.log(`Successfully force-canceled run ${runId}`);
              } catch (error) {
                console.log(`Failed to force-cancel run ${runId}: ${error.message}`);
              }
            }
            
            console.log('All cancel requests completed');
